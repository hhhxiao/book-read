### TCP协议详解

#### TCP服务特点

- 面向连接　　双方建立连接后方可进行数据通信
- 字节流　　发送端执行的写操作次数和接收端执行的读操作次数没有任何关系
- 可靠传输　 采用发送应答机制　和超市重传机制

TCP连接是全双工的通信

### TCP头部结构

- 16位源端口号  告知该报文段是来自哪个端口,客户端一般使用系统自动分配的端口号,服务端使用知名服务的端口号(比如`http`是80)
- 16位目的端口号 同上
- 32位序号  一次TCP通信过程中一个传输方向上的字节流每个字节的编号,第一个报文段的序号值是系统生产的随机值,以后的数据报中该值位初始序列值加上**该报文所携带的数据的第一个字节在整个字节流中的偏移**
- 32位确认号  用作对一方发来的TCP报文段的响应.其值是**收到的TCP报文段的序号值+1**
- 4位头部长n 标识TCP头部的长度位为n*4个字节
- 6位保留 保留
- `URG` 表示紧急指针是否有效
- `ACK` 确认号是否有效,携带ACK标志的TCP报文段称之为确认报文段
- `PSH` 告知接收端应用程序立即从TCP接受缓冲区读走数据,为接受后续数据腾出空间
- `RST` 带有该标志的报文段叫复位报文段,表示要求对方重新建立连接
- `SYN` 带有该标志的报文段称之为同步报文段,表示请求建立一个连接
- `FIN` 带有该标志的报文段称之为结束报文段,表示要关闭连接了
- 16位窗口大小 TCP的流量控制手段,告诉本端的TCP接收缓冲区还能容纳多少字节
- 16位校验和  由发送端填充,用CRC算法校验数据报在传输过程中是否有损坏
- 16位紧急指针 紧急偏移
- 最多40字节的选项  加上最多40字节的选项,TCP头部字节最多60字节

