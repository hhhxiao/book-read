###  异常控制流

从给处理器加电起，直到断电为止，程序计数器都维护着一个指令序列，不同指令之间的过渡称之为控制转移(control transfer),这样的控制转移序列称为**控制流**。有时候控制流会发生突变（比如你突然要计算机执行一个程序，就会打乱原来的控制流），这样的控制流称为**异常控制流(ECF)**

理解ECF的重要性：

- 有助于理解重要的系统概念
- 有助于理解应用程序如何和系统进行交互
- 有助于理解并发
- 有助于理解软件异常（c++,java的exception等）

### 异常

异常(exception)是异常控制流的一部分，它的一部分=由硬件实现，一部分由操作系统实现，异常用来响应处理器状态中的某些变化。在处理器中状态被编码成不同的位或者信号，这样的状态变化称之为**事件**。常见的事件有虚拟内存缺页，除以0等等。

当处理器检测到事件发生后,会通过一个**异常表**的跳转表进行过程调用,也就是开始执行异常处理程序,当该程序执行完成后会发生如下情况中的一种:

- 处理程序将控制返回给当时正在执行的指令
- 处理程序把控制返回给当时正在执行的指令的下一条指令
- 处理器中断程序

> 注意区分硬件异常和软件异常

### 异常处理

系统中每种类型的异常都有一个非负的异常号,一部分由处理器的设计者分配,一部分由操作系统内核的设计者分配.

异常分为**中断(interrupt),陷阱(trap),故障(fault),终止(abort)**四类:

| 类别 | 原因         | 异步/同步 | 返回的指令           |
| ---- | ------------ | --------- | -------------------- |
| 中断 | 来自IO的设备 | 异步      |总是返回到下一条指令 |
| 陷阱 | 有意的异常 | 同步 | 总是返回到下一条指令 |
| 故障 | 潜在可恢复的错误 | 同步 | 可能返回到当前指令 |
| 中止 | 不可恢复的错误 | 同步 | 不会返回 |

