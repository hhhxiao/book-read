### 链接（link）

### ELF 文件

elf文件是linux下的主要的可执行文件格式，常用的文件格式有`.o,.so,.elf`等。由Unix系统实验室开发和发布。

### 编译器驱动程序(complier driver)

编译系统提供的编译器驱动程序代表用户在需要的时候调用语言的预处理器，编译器，汇编器和连接器。

-  预处理器处理源程序生成`.i`文件
- 编译器编译`.i`文件生成汇编语言文件`.s`
- 汇编器把`.s`文件翻译成可重定位目标文件`.o`
- 连接器吧`.o`以及其他一些文件组合起来形成可执行文件
- 执行：`shell`调用一个加载器(locader)函数，可以把可执行文件中的代码和数据复制到内存，然后把控制转移到这个程序的开头。

### 静态链接

静态连接器做的事情：以一组可重定位目标文件（链接的标准库也是可重定位目标文件）（也就是经过汇编器处理后的.o文件）和命令行参数作为输入，生成一个完全链接的，可加载和运行可执行目标文件作为输出（这也是mingw里面的C库里面都`.o`和`.a`文件的原因）。

C的标准库都是`.h`头文件或者`.a/.o`格式的可重定位目标文件。前者在编译的时候使用，后者在链接的时候使用。

连接器完成的两个任务：

- 符号解析（symbol resolution），将符号和函数，静态变量等联系起来。
- 重定位（relocation）把每个符号定义与一个内存位置关联起来

### 目标文件(target file)

三种形式的目标文件：

- 可重定位目标文件（Relocationable target file）,包含二进制代码和数据，可以通过链接过程和其它可重定位文件合并形成可执行文件
- 可执行目标文件（executable target file）包含二进制代码和数据，可直接被复制到内存中执行
- 共享目标文件（shared target file）可在加载或者运行的时候被动态的加载进内存并链接

目标文件按照特定的格式来组织，各个系统的目标文件的格式不尽相同。

### 可重定位目标文件

> 以下以一个典型的elf可重定位目标文件为例

elf文件以一个16字节的ELF头开始，后面是目标文件信息，末尾是节头部表。典型的ELF包含如下的节：

- .text 	已经编译的机器码
- .rodata     只读数据
- .bss    已经初始化的全局和静态的C变量
- .symtab   符号表
- .rel.text     
- .rel.data
- .debug   调试符号表
- .line  行号和机器码之间的映射
- .strtable    字符串表

### 符号（symbol）和符号表（symbol table）

每个可重定位目标文件（模块）中都有一个符号表，包含符号的相关信息。

符号的分类：

- 由该模块定义并且能被其它模块引用的全局符号
- 有其它模块定义并且被m引用的符号
- m内部的自己定义和引用的局部符号

> 建议补习C语言中的static的用法。

符号表是一个数组，数组中的每个元素都是`Elf64_Symbol`类型：

```C
typedef struct{
	int name;
    ..//other members
}Elf64_Symbol;
```

有关的属性以及解释：

- name:字符串表中的字节偏移（表示并不懂是什么东西）
- value:符号的地址（距定义目标节的起始位置便宜）
- size：目标符号的大小
- type: 符号类型（数据或者函数）

> 有关符号的其它部分我也不是很懂了。。下一个文件里面详细解释下。

