### 链接（link）

### ELF 文件

elf文件是linux下的主要的可执行文件格式，常用的文件格式有`.o,.so,.elf`等。由Unix系统实验室开发和发布。

### 编译器驱动程序(complier driver)

编译系统提供的编译器驱动程序代表用户在需要的时候调用语言的预处理器，编译器，汇编器和连接器。

-  预处理器处理源程序生成`.i`文件
- 编译器编译`.i`文件生成汇编语言文件`.s`
- 汇编器把`.s`文件翻译成可重定位目标文件`.o`
- 连接器吧`.o`以及其他一些文件组合起来形成可执行文件
- 执行：`shell`调用一个加载器(locader)函数，可以把可执行文件中的代码和数据复制到内存，然后把控制转移到这个程序的开头。

> 注：中文版把Object file翻译成目标文件，我个人不太喜欢，还是保留成了object文件.

### 静态链接

静态连接器做的事情：以一组可重定位obj文件（链接的标准库也是可重定位obj文件）（也就是经过汇编器处理后的.o文件）和命令行参数作为输入，生成一个完全链接的，可加载和运行可执行目标文件作为输出（这也是mingw里面的C库里面都`.o`和`.a`文件的原因）。

C的标准库都是`.h`头文件或者`.a/.o`格式的可重定位obj文件。前者在编译的时候使用，后者在链接的时候使用。

链接器完成的两个任务：

- 符号解析（symbol resolution），将符号和函数，静态变量等联系起来。
- 重定位（relocation）把每个符号定义与一个内存位置关联起来

### Obj 文件(Object file)

三种形式的obj文件：

- 可重定位obj文件（Relocationable object file）,包含二进制代码和数据，可以通过链接过程和其它可重定位文件合并形成可执行文件
- 可执行obj文件（executable object file）包含二进制代码和数据，可直接被复制到内存中执行
- 共享obj文件（shared objectfile）可在加载或者运行的时候被动态的加载进内存并链接

目标文件按照特定的格式来组织，各个系统的目标文件的格式不尽相同。

### 可重定位的OBJ文件

> 以下以一个典型的elf可重定位目标文件为例

elf文件以一个16字节的*ELF header*开始，后面是目标文件信息，末尾是节头部表。头部表的其它部分是一些有助于连接器进行解析和翻译obj文件的信息。比如说ELF header 的大小，obj文件的类型（可重定位，可执行还是共享），机器（CPU）类型等信息。各个节的位置和大小由节头部表（*section header table*）描述。其它节在这两个头部表之间:

- .text 	已经编译的机器码
- .rodata     只读数据,比如一些字符串
- .data 已经初始化的全局C变量，局部C变量在运行时的栈上，不在`.data`或者`.bss`中
- .bss    没有初始化的全局C变量
- .symtab   存放一些在程序中被定义和引用的全局变量以及函数
- .rel.text     
- .rel.data
- .debug   调试符号表
- .line  行号和机器码之间的映射
- .strtable    字符串表
